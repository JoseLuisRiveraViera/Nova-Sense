================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\app\(dashboard)\rivers\page.tsx
================================================================================
import { InteractiveMap } from '@/components/map/InteractiveMap';
import { generateMockStations } from '@/lib/mockData';
import { Card, CardContent } from '@/components/ui/card';
import { MapPin, Droplets, AlertTriangle } from 'lucide-react';

export default function RiversPage() {
  const stations = generateMockStations();

  const safeCount = stations.filter(s => s.quality === 'Buena').length;
  const cautionCount = stations.filter(s => s.quality === 'Moderada').length;
  const dangerCount = stations.filter(s => s.quality === 'Peligrosa').length;

  return (
    <div className="flex flex-1 flex-col">
      <div className="@container/main flex flex-1 flex-col gap-4">
        {/* Header */}
        <div className="px-4 lg:px-6 pt-4">
          <div className="flex flex-col gap-2">
            <div className="flex items-center gap-2">
              <div className="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-600 to-blue-600 flex items-center justify-center">
                <MapPin className="w-6 h-6 text-white" aria-hidden />
              </div>
              <div>
                <h1 className="text-2xl md:text-3xl font-bold text-slate-900">
                  Mapa de Fuentes de Agua
                </h1>
                <p className="text-slate-600">
                  Explora el estado del agua en tiempo real en Nayarit
                </p>
              </div>
            </div>
          </div>
        </div>

        {/* Quick Stats */}
        <div className="grid grid-cols-3 gap-3 px-4 lg:px-6" aria-label="Resumen por estado">
          <Card className="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200">
            <CardContent className="p-4">
              <div className="text-center">
                <div className="text-2xl font-bold text-green-700">{safeCount}</div>
                <div className="text-xs text-green-700 font-medium">Seguras</div>
              </div>
            </CardContent>
          </Card>

          <Card className="bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-200">
            <CardContent className="p-4">
              <div className="text-center">
                <div className="text-2xl font-bold text-yellow-700">{cautionCount}</div>
                <div className="text-xs text-yellow-700 font-medium">PrecauciÃ³n</div>
              </div>
            </CardContent>
          </Card>

          <Card className="bg-gradient-to-br from-red-50 to-rose-50 border-2 border-red-200">
            <CardContent className="p-4">
              <div className="text-center">
                <div className="text-2xl font-bold text-red-700">{dangerCount}</div>
                <div className="text-xs text-red-700 font-medium">Peligrosas</div>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Map */}
        <div className="flex-1 px-4 lg:px-6 pb-4">
          <div className="h-[calc(100vh-280px)] min-h-[500px]">
            <InteractiveMap stations={stations} />
          </div>
        </div>

        {/* Info Cards */}
        <div className="grid md:grid-cols-2 gap-4 px-4 lg:px-6 pb-6">
          <div className="border-2 border-cyan-200 bg-gradient-to-br from-cyan-50 to-blue-50 rounded-lg">
            <div className="p-4">
              <div className="flex items-center gap-2 text-lg mb-2">
                <Droplets className="w-5 h-5 text-cyan-600" aria-hidden />
                <span className="font-semibold">CÃ³mo usar el mapa</span>
              </div>
              <ul className="space-y-2 text-sm text-slate-700">
                <li>ðŸ§­ <strong>Haz clic en los marcadores</strong> para ver detalles.</li>
                <li>ðŸ” <strong>Usa los controles</strong> (derecha) para navegar.</li>
                <li>ðŸ“ <strong>Encuentra tu ubicaciÃ³n</strong> con el botÃ³n de geolocalizaciÃ³n.</li>
                <li>ðŸŽ¯ <strong>Filtra fuentes</strong> por estado del agua.</li>
              </ul>
            </div>
          </div>

          <div className="border-2 border-orange-200 bg-gradient-to-br from-orange-50 to-yellow-50 rounded-lg">
            <div className="p-4">
              <div className="flex items-center gap-2 text-lg mb-2">
                <AlertTriangle className="w-5 h-5 text-orange-600" aria-hidden />
                <span className="font-semibold">Recomendaciones importantes</span>
              </div>
              <ul className="space-y-2 text-sm text-slate-700">
                <li>âœ… <strong>Agua verde:</strong> Segura al hervirla.</li>
                <li>âš ï¸ <strong>Agua amarilla:</strong> Ãšsala solo para riego.</li>
                <li>ðŸš« <strong>Agua roja:</strong> No la uses.</li>
                <li>ðŸ•’ <strong>Datos simulados:</strong> se regeneran al cargar.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\components\map\InteractiveMap.tsx
================================================================================
"use client";

import dynamic from 'next/dynamic';
import { Station } from '@/types';
import { Skeleton } from '@/components/ui/skeleton';

const LeafletMap = dynamic(
  () => import('./LeafletMap').then(mod => ({ default: mod.LeafletMap })),
  { ssr: false, loading: () => <MapSkeleton /> }
);

interface InteractiveMapProps {
  stations: Station[];
}

function MapSkeleton() {
  return (
    <div className="relative w-full h-full bg-slate-100 rounded-xl border-2 border-slate-200 overflow-hidden" role="status" aria-live="polite">
      <Skeleton className="w-full h-full" />
      <div className="absolute top-6 right-6 space-y-2">
        <Skeleton className="w-10 h-10 rounded-md" />
        <Skeleton className="w-10 h-10 rounded-md" />
        <Skeleton className="w-10 h-10 rounded-md" />
        <Skeleton className="w-10 h-10 rounded-md" />
      </div>
      <div className="absolute bottom-6 left-6">
        <Skeleton className="w-56 h-44 rounded-lg" />
      </div>
      <div className="absolute top-6 left-6">
        <Skeleton className="w-28 h-10 rounded-md" />
      </div>
      <div className="absolute inset-0 flex items-center justify-center">
        <div className="bg-white/90 backdrop-blur-sm px-8 py-4 rounded-lg shadow-xl border-2 border-cyan-200">
          <div className="flex items-center gap-3">
            <div className="w-5 h-5 border-4 border-cyan-600 border-t-transparent rounded-full animate-spin" aria-hidden />
            <p className="text-lg font-semibold text-slate-900">
              Cargando mapa de fuentes de aguaâ€¦
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

export function InteractiveMap({ stations }: InteractiveMapProps) {
  return <LeafletMap stations={stations} />;
}

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\components\map\LeafletMap.tsx
================================================================================
"use client";

import { useMemo, useState } from 'react';
import { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';
import { renderToStaticMarkup } from 'react-dom/server';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import { Station } from '@/types';
import { StationCard } from './StationCard';
import { MapControls } from './MapControls';
import { MapLegend } from './MapLegend';
import { MapFilters, FilterState } from './MapFilters';
import { generateMockReadings } from '@/lib/mockData';
import { createCustomIcon, tileLayerConfig, mapConfig } from '@/lib/mapHelpers';

// Fix de iconos Leaflet en Next.js
delete (L.Icon.Default.prototype as any)._getIconUrl;
L.Icon.Default.mergeOptions({
  iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
  iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
});

interface LeafletMapProps { stations: Station[]; }

export function LeafletMap({ stations }: LeafletMapProps) {
  const [filteredStations, setFilteredStations] = useState<Station[]>(stations);

  const handleFilterChange = (filters: FilterState) => {
    const filtered = stations.filter(station => {
      const q = filters.qualities.has(station.quality);
      const t = !station.trend || filters.trends.has(station.trend);
      return q && t;
    });
    setFilteredStations(filtered);
  };

  const counts = useMemo(() => ({
    Buena: filteredStations.filter(s => s.quality === 'Buena').length,
    Moderada: filteredStations.filter(s => s.quality === 'Moderada').length,
    Peligrosa: filteredStations.filter(s => s.quality === 'Peligrosa').length,
  }), [filteredStations]);

  return (
    <div className="relative w-full h-full">
      <MapContainer
        id="rivers-map"
        aria-label="Mapa de fuentes de agua"
        center={mapConfig.center}
        zoom={mapConfig.zoom}
        minZoom={mapConfig.minZoom}
        maxZoom={mapConfig.maxZoom}
        className="w-full h-full rounded-xl shadow-2xl border-2 border-slate-200 z-[1]"
        zoomControl={false}
      >
        <TileLayer {...tileLayerConfig} />
        {filteredStations.map((station) => {
          const latestReading = generateMockReadings(station.id, 1)[0];
          return (
            <Marker
              key={station.id}
              position={station.coordinates} // [lat, lng] âœ…
              icon={createCustomIcon(station.quality)}
            >
              <Popup
                /* estilos vienen de globals.css */
                maxWidth={320}
                minWidth={280}
                closeButton={true}
                autoPan
                autoPanPadding={[24, 96]}
              >
                <div
                  dangerouslySetInnerHTML={{
                    __html: renderToStaticMarkup(
                      <StationCard
                        station={station}
                        latestReading={latestReading}
                        showDetailsButton
                      />
                    )
                  }}
                />
              </Popup>
            </Marker>
          );
        })}

        <MapControls />
      </MapContainer>

      <MapLegend counts={counts} />
      <MapFilters onFilterChange={handleFilterChange} />

      {/* Burbuja: a la derecha, sin tapar el popup */}
      <div className="absolute top-6 right-[88px] sm:right-28 z-[900] pointer-events-none" aria-live="polite">
        <div className="bg-white/95 backdrop-blur-sm px-5 py-2 rounded-full shadow-md border border-slate-200">
          <p className="text-xs font-medium text-slate-700">
            Mostrando <span className="font-bold text-cyan-600">{filteredStations.length}</span> de {stations.length} fuentes de agua
          </p>
        </div>
      </div>
    </div>
  );
}

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\components\map\MapControls.tsx
================================================================================
"use client";

import { Button } from '@/components/ui/button';
import { Plus, Minus, Locate, RotateCcw } from 'lucide-react';
import { useMap } from 'react-leaflet';
import { mapConfig } from '@/lib/mapHelpers';

export function MapControls() {
  const map = useMap();

  const handleZoomIn = () => map.zoomIn();
  const handleZoomOut = () => map.zoomOut();

  const handleLocate = () => {
    if (!navigator.geolocation) {
      alert('Tu navegador no soporta geolocalizaciÃ³n.');
      return;
    }
    navigator.geolocation.getCurrentPosition(
      (position) => {
        map.flyTo([position.coords.latitude, position.coords.longitude], 13, { duration: 1.5 });
      },
      () => {
        alert('No se pudo obtener tu ubicaciÃ³n. Revisa permisos del navegador.');
      }
    );
  };

  const handleReset = () => {
    map.setView(mapConfig.center, mapConfig.zoom, { animate: true });
  };

  return (
    <div className="absolute top-6 right-6 z-[1000] flex flex-col gap-2" role="group" aria-label="Controles del mapa">
      <Button
        size="icon"
        variant="secondary"
        onClick={handleZoomIn}
        className="bg-white/95 backdrop-blur-sm hover:bg-white shadow-lg border-2 border-slate-200 focus-visible:ring-2 focus-visible:ring-cyan-600"
        title="Acercar"
        aria-label="Acercar"
      >
        <Plus className="w-5 h-5 text-slate-700" aria-hidden />
      </Button>

      <Button
        size="icon"
        variant="secondary"
        onClick={handleZoomOut}
        className="bg-white/95 backdrop-blur-sm hover:bg-white shadow-lg border-2 border-slate-200 focus-visible:ring-2 focus-visible:ring-cyan-600"
        title="Alejar"
        aria-label="Alejar"
      >
        <Minus className="w-5 h-5 text-slate-700" aria-hidden />
      </Button>

      <Button
        size="icon"
        variant="secondary"
        onClick={handleLocate}
        className="bg-white/95 backdrop-blur-sm hover:bg-white shadow-lg border-2 border-slate-200 focus-visible:ring-2 focus-visible:ring-cyan-600"
        title="Mi ubicaciÃ³n"
        aria-label="Ir a mi ubicaciÃ³n"
      >
        <Locate className="w-5 h-5 text-cyan-600" aria-hidden />
      </Button>

      <Button
        size="icon"
        variant="secondary"
        onClick={handleReset}
        className="bg-white/95 backdrop-blur-sm hover:bg-white shadow-lg border-2 border-slate-200 focus-visible:ring-2 focus-visible:ring-cyan-600"
        title="Restablecer vista"
        aria-label="Restablecer vista"
      >
        <RotateCcw className="w-5 h-5 text-slate-700" aria-hidden />
      </Button>
    </div>
  );
}

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\components\map\MapFilters.tsx
================================================================================
"use client";

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet';
import { Checkbox } from '@/components/ui/checkbox';
import { Filter, X } from 'lucide-react';
import { Station, WaterTrend } from '@/types';

interface MapFiltersProps {
  onFilterChange: (filters: FilterState) => void;
}

export interface FilterState {
  qualities: Set<Station['quality']>;
  trends: Set<WaterTrend>;
}

export function MapFilters({ onFilterChange }: MapFiltersProps) {
  const [open, setOpen] = useState(false);

  const [filters, setFilters] = useState<FilterState>({
    qualities: new Set(['Buena', 'Moderada', 'Peligrosa']),
    trends: new Set(['improving', 'stable', 'worsening']),
  });

  const handleQualityToggle = (quality: Station['quality']) => {
    const qualities = new Set(filters.qualities);
    qualities.has(quality) ? qualities.delete(quality) : qualities.add(quality);
    const next = { ...filters, qualities };
    setFilters(next);
    onFilterChange(next);
  };

  const handleTrendToggle = (trend: Station['trend']) => {
    if (!trend) return;
    const trends = new Set(filters.trends);
    trends.has(trend) ? trends.delete(trend) : trends.add(trend);
    const next = { ...filters, trends };
    setFilters(next);
    onFilterChange(next);
  };

  const handleReset = () => {
    const next: FilterState = {
      qualities: new Set(['Buena', 'Moderada', 'Peligrosa']),
      trends: new Set(['improving', 'stable', 'worsening']),
    };
    setFilters(next);
    onFilterChange(next);
  };

  const activeFiltersCount = (3 - filters.qualities.size) + (3 - filters.trends.size);

  return (
    <Sheet open={open} onOpenChange={setOpen}>
      {open && (
        <div
          onClick={() => setOpen(false)}
          className="fixed inset-0 z-[3000] bg-slate-950/60 backdrop-blur-sm transition-opacity"
          aria-hidden
        />
      )}

      <SheetTrigger asChild>
        <Button
          variant="secondary"
          className="absolute top-6 left-6 z-[1000] bg-white/95 backdrop-blur-sm hover:bg-white shadow-lg border-2 border-slate-200 focus-visible:ring-2 focus-visible:ring-cyan-600"
          aria-haspopup="dialog"
          aria-expanded={open}
          aria-controls="filters-panel"
        >
          <Filter className="w-4 h-4 mr-2 text-slate-700" aria-hidden />
          Filtrar
          {activeFiltersCount > 0 && <Badge variant="destructive" className="ml-2">{activeFiltersCount}</Badge>}
        </Button>
      </SheetTrigger>

      <SheetContent
        id="filters-panel"
        side="right"
        className="z-[3100] w-[400px] sm:w-[440px] p-0 border-0 rounded-l-2xl shadow-2xl bg-white/95 backdrop-blur-md"
        aria-label="Panel de filtros"
      >
        <SheetHeader className="sticky top-0 z-10 px-6 py-5 border-b bg-white/90 backdrop-blur-md">
          <div className="flex items-start justify-between">
            <div>
              <SheetTitle className="text-xl font-bold text-slate-900">Filtrar Fuentes de Agua</SheetTitle>
              <SheetDescription className="text-slate-600">Elige quÃ© fuentes quieres ver en el mapa</SheetDescription>
            </div>
            <button
              onClick={() => setOpen(false)}
              aria-label="Cerrar panel de filtros"
              className="inline-flex items-center justify-center h-8 w-8 rounded-md text-slate-600 hover:text-slate-800 hover:bg-slate-200/60"
            >
              <X className="h-4 w-4" aria-hidden />
            </button>
          </div>
        </SheetHeader>

        <div className="px-6 pt-6 pb-20 space-y-6">
          {/* Calidad del Agua */}
          <section aria-labelledby="calidad-title">
            <h3 id="calidad-title" className="font-semibold text-base text-slate-900">Calidad del Agua</h3>

            <div className="mt-3 space-y-3">
              <label htmlFor="buena" className="flex items-center gap-2 cursor-pointer text-sm">
                <Checkbox id="buena" checked={filters.qualities.has('Buena')} onCheckedChange={() => handleQualityToggle('Buena')} />
                <span className="w-3 h-3 rounded-full bg-green-500" aria-hidden />
                Agua segura
              </label>

              <label htmlFor="moderada" className="flex items-center gap-2 cursor-pointer text-sm">
                <Checkbox id="moderada" checked={filters.qualities.has('Moderada')} onCheckedChange={() => handleQualityToggle('Moderada')} />
                <span className="w-3 h-3 rounded-full bg-yellow-500" aria-hidden />
                Usar con precauciÃ³n
              </label>

              <label htmlFor="peligrosa" className="flex items-center gap-2 cursor-pointer text-sm">
                <Checkbox id="peligrosa" checked={filters.qualities.has('Peligrosa')} onCheckedChange={() => handleQualityToggle('Peligrosa')} />
                <span className="w-3 h-3 rounded-full bg-red-500" aria-hidden />
                No usar
              </label>
            </div>
          </section>

          <div className="border-t border-slate-200/70" />

          {/* Tendencia */}
          <section aria-labelledby="tendencia-title">
            <h3 id="tendencia-title" className="font-semibold text-base text-slate-900">Tendencia</h3>

            <div className="mt-3 space-y-3">
              <label htmlFor="improving" className="flex items-center gap-2 cursor-pointer text-sm">
                <Checkbox id="improving" checked={filters.trends.has('improving')} onCheckedChange={() => handleTrendToggle('improving')} />
                ðŸ“ˆ Mejorando
              </label>

              <label htmlFor="stable" className="flex items-center gap-2 cursor-pointer text-sm">
                <Checkbox id="stable" checked={filters.trends.has('stable')} onCheckedChange={() => handleTrendToggle('stable')} />
                âž¡ï¸ Estable
              </label>

              <label htmlFor="worsening" className="flex items-center gap-2 cursor-pointer text-sm">
                <Checkbox id="worsening" checked={filters.trends.has('worsening')} onCheckedChange={() => handleTrendToggle('worsening')} />
                ðŸ“‰ Deteriorando
              </label>
            </div>
          </section>
        </div>

        <div className="absolute bottom-0 left-0 w-full px-6 py-4 border-t bg-white/95 backdrop-blur-md rounded-bl-2xl">
          <Button variant="outline" onClick={handleReset} className="w-full">
            <X className="w-4 h-4 mr-2" aria-hidden /> Limpiar filtros
          </Button>
        </div>
      </SheetContent>
    </Sheet>
  );
}

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\components\map\MapLegend.tsx
================================================================================
"use client";

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { CheckCircle2, AlertTriangle, XCircle } from 'lucide-react';
import { WaterQuality } from '@/types';

export interface MapLegendProps {
  counts?: Record<WaterQuality, number>;
}

export function MapLegend({ counts }: MapLegendProps) {
  return (
    <Card className="absolute bottom-6 left-6 z-[1000] bg-white/95 backdrop-blur-sm shadow-xl border-2 border-slate-200"
          role="region" aria-label="Leyenda de estados del agua">
      <CardHeader className="pb-3">
        <CardTitle className="text-sm font-semibold text-slate-900">Estado del agua</CardTitle>
      </CardHeader>
      <CardContent className="space-y-3">
        <div className="flex items-center gap-3">
          <div className="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center shadow-md" aria-hidden>
            <CheckCircle2 className="w-4 h-4 text-white" />
          </div>
          <div className="flex items-center gap-2">
            <div>
              <div className="font-medium text-sm text-slate-900">Agua segura</div>
              <div className="text-xs text-slate-600">Apta para consumo</div>
            </div>
            {counts && <Badge variant="outline" className="ml-1">{counts.Buena}</Badge>}
          </div>
        </div>

        <div className="flex items-center gap-3">
          <div className="w-6 h-6 rounded-full bg-yellow-500 flex items-center justify-center shadow-md" aria-hidden>
            <AlertTriangle className="w-4 h-4 text-white" />
          </div>
          <div className="flex items-center gap-2">
            <div>
              <div className="font-medium text-sm text-slate-900">PrecauciÃ³n</div>
              <div className="text-xs text-slate-600">Solo para riego</div>
            </div>
            {counts && <Badge variant="outline" className="ml-1">{counts.Moderada}</Badge>}
          </div>
        </div>

        <div className="flex items-center gap-3">
          <div className="w-6 h-6 rounded-full bg-red-500 flex items-center justify-center shadow-md" aria-hidden>
            <XCircle className="w-4 h-4 text-white" />
          </div>
          <div className="flex items-center gap-2">
            <div>
              <div className="font-medium text-sm text-slate-900">No usar</div>
              <div className="text-xs text-slate-600">Agua contaminada</div>
            </div>
            {counts && <Badge variant="outline" className="ml-1">{counts.Peligrosa}</Badge>}
          </div>
        </div>

        <div className="pt-2 border-t border-slate-200">
          <Badge variant="outline" className="text-xs bg-cyan-50 text-cyan-700 border-cyan-300">
            Datos simulados
          </Badge>
        </div>
      </CardContent>
    </Card>
  );
}

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\components\map\StationCard.tsx
================================================================================
import { Station, Reading } from '@/types';
import { Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Droplet, Thermometer, Wind, Activity, TrendingUp, TrendingDown, BarChart3 } from 'lucide-react';
import { getBackgroundByQuality, getBorderColorByQuality, getEmojiByQuality, getMessageByQuality } from '@/lib/mapHelpers';

interface StationCardProps {
  station: Station;
  latestReading?: Reading;
  showDetailsButton?: boolean;
}

export function StationCard({ station, latestReading, showDetailsButton = false }: StationCardProps) {
  const bgGradient = getBackgroundByQuality(station.quality);
  const borderColor = getBorderColorByQuality(station.quality);
  const emoji = getEmojiByQuality(station.quality);
  const message = getMessageByQuality(station.quality);

  const getBadgeVariant = () => {
    switch (station.quality) {
      case 'Buena': return 'default';
      case 'Moderada': return 'secondary';
      case 'Peligrosa': return 'destructive';
      default: return 'outline';
    }
  };

  return (
    <Card className={`w-[280px] rounded-2xl border ${borderColor} bg-gradient-to-br ${bgGradient} shadow-xl overflow-hidden`}>
      {station.imageUrl && (
        <div className="w-full h-16 overflow-hidden">
          <img src={station.imageUrl} alt={station.name} className="w-full h-full object-cover" />
        </div>
      )}

      <CardHeader className="pb-2 pt-2 px-3">
        <div className="flex items-start justify-between gap-2">
          <CardTitle className="text-sm font-bold text-slate-900 leading-tight">{station.name}</CardTitle>
          <Badge variant={getBadgeVariant()} className="flex-shrink-0 text-[10px] px-2 py-0.5 rounded-full">
            {station.quality}
          </Badge>
        </div>
        <CardDescription className="text-[11px] font-medium text-slate-700 mt-1 leading-snug">
          {emoji} {message}
        </CardDescription>
      </CardHeader>

      <CardContent className="space-y-2 px-3 pb-2">
        {station.description && (
          <p className="text-[11px] text-slate-700 bg-white/80 rounded-md p-2 leading-snug">
            {station.description}
          </p>
        )}

        {latestReading && (
          <div className="grid grid-cols-2 gap-1.5" role="list" aria-label="ParÃ¡metros de calidad">
            <div className="flex items-center gap-1.5 p-1.5 bg-white/80 rounded-md" role="listitem">
              <Droplet className="w-3.5 h-3.5 text-blue-600" aria-hidden />
              <div>
                <div className="text-[10px] text-slate-600 leading-none">pH</div>
                <div className="text-[12px] font-semibold text-slate-900 leading-none mt-0.5">{latestReading.ph.toFixed(1)}</div>
              </div>
            </div>

            <div className="flex items-center gap-1.5 p-1.5 bg-white/80 rounded-md" role="listitem">
              <Wind className="w-3.5 h-3.5 text-slate-600" aria-hidden />
              <div>
                <div className="text-[10px] text-slate-600 leading-none">Turbidez (NTU)</div>
                <div className="text-[12px] font-semibold text-slate-900 leading-none mt-0.5">{latestReading.turbidity.toFixed(1)}</div>
              </div>
            </div>

            <div className="flex items-center gap-1.5 p-1.5 bg-white/80 rounded-md" role="listitem">
              <Activity className="w-3.5 h-3.5 text-cyan-600" aria-hidden />
              <div>
                <div className="text-[10px] text-slate-600 leading-none">OxÃ­geno (mg/L)</div>
                <div className="text-[12px] font-semibold text-slate-900 leading-none mt-0.5">{latestReading.oxygen.toFixed(1)}</div>
              </div>
            </div>

            <div className="flex items-center gap-1.5 p-1.5 bg-white/80 rounded-md" role="listitem">
              <Thermometer className="w-3.5 h-3.5 text-orange-600" aria-hidden />
              <div>
                <div className="text-[10px] text-slate-600 leading-none">Temp. (Â°C)</div>
                <div className="text-[12px] font-semibold text-slate-900 leading-none mt-0.5">{latestReading.temperature.toFixed(1)}</div>
              </div>
            </div>
          </div>
        )}

        {station.trend && (
          <div className="flex items-center gap-1.5 p-1.5 bg-white/80 rounded-md">
            {station.trend === 'improving' ? (
              <>
                <TrendingUp className="w-3.5 h-3.5 text-green-600" aria-hidden />
                <span className="text-[11px] text-slate-700">Mejorando</span>
              </>
            ) : station.trend === 'worsening' ? (
              <>
                <TrendingDown className="w-3.5 h-3.5 text-red-600" aria-hidden />
                <span className="text-[11px] text-slate-700">Deteriorando</span>
              </>
            ) : (
              <span className="text-[11px] text-slate-700">Estable</span>
            )}
          </div>
        )}
      </CardContent>

      {showDetailsButton && (
        <CardFooter className="pt-0 pb-2 px-3">
          <a
            href={`/stats?station=${station.id}`}
            className="w-full inline-flex items-center justify-center gap-1.5 h-8 text-[12px] font-semibold text-white bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 rounded-md transition-colors shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-600"
          >
            <BarChart3 className="w-4 h-4" aria-hidden />
            Ver estadÃ­sticas
          </a>
        </CardFooter>
      )}

      <div className="px-3 pb-2">
        <div className="text-[10px] text-slate-500 text-center">
          {station.lastUpdated.toLocaleString('es-MX', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' })}
        </div>
      </div>
    </Card>
  );
}

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\lib\mapHelpers.ts
================================================================================
import L from 'leaflet';
import { Station } from '@/types';

/** Color del marcador por calidad */
export function getColorByQuality(quality: Station['quality']): string {
  switch (quality) {
    case 'Buena': return '#10B981'; // emerald-500
    case 'Moderada': return '#F59E0B'; // yellow-500
    case 'Peligrosa': return '#EF4444'; // red-500
    default: return '#3B82F6'; // blue-500
  }
}

/** Fondo del popup por calidad */
export function getBackgroundByQuality(quality: Station['quality']): string {
  switch (quality) {
    case 'Buena': return 'from-green-50 to-emerald-50';
    case 'Moderada': return 'from-yellow-50 to-orange-50';
    case 'Peligrosa': return 'from-red-50 to-rose-50';
    default: return 'from-blue-50 to-cyan-50';
  }
}

/** Borde por calidad */
export function getBorderColorByQuality(quality: Station['quality']): string {
  switch (quality) {
    case 'Buena': return 'border-green-300';
    case 'Moderada': return 'border-yellow-300';
    case 'Peligrosa': return 'border-red-300';
    default: return 'border-blue-300';
  }
}

/** Emoji por calidad */
export function getEmojiByQuality(quality: Station['quality']): string {
  switch (quality) {
    case 'Buena': return 'âœ…';
    case 'Moderada': return 'âš ï¸';
    case 'Peligrosa': return 'ðŸš«';
    default: return 'ðŸ’§';
  }
}

/** Mensaje por calidad (lenguaje ciudadano) */
export function getMessageByQuality(quality: Station['quality']): string {
  switch (quality) {
    case 'Buena': return 'Apta para consumo humano';
    case 'Moderada': return 'Solo para riego â€” no consumir';
    case 'Peligrosa': return 'No usar â€” agua contaminada';
    default: return 'Estado desconocido';
  }
}

/** Icono personalizado del marcador */
export function createCustomIcon(quality: Station['quality']): L.DivIcon {
  const color = getColorByQuality(quality);
  const emoji = getEmojiByQuality(quality);

  return L.divIcon({
    html: `
      <div class="relative">
        <div class="w-10 h-10 rounded-full flex items-center justify-center shadow-lg border-2 border-white" style="background-color:${color}">
          <span class="text-lg">${emoji}</span>
        </div>
        <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 w-3 h-3 rotate-45 border-r-2 border-b-2 border-white" style="background-color:${color}"></div>
      </div>
    `,
    className: 'custom-marker',
    iconSize: [40, 40],
    iconAnchor: [20, 40],
    popupAnchor: [0, -40],
  });
}

/** Config de tiles */
export const tileLayerConfig = {
  url: 'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
  maxZoom: 19,
};

/** Config inicial del mapa (Nayarit) */
export const mapConfig = {
  center: [21.5, -104.9] as [number, number],
  zoom: 9,
  minZoom: 8,
  maxZoom: 18,
};

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\lib\mockData.ts
================================================================================
// src/lib/mockData.ts
import { Station, Reading, Alert, WaterQuality, WaterTrend } from "@/types";

const stationsData: Omit<Station, "lastUpdated">[] = [
  {
    id: "1",
    name: "RÃ­o San Pedro",
    coordinates: [22.226102510029904, -105.00979212636152],
    quality: "Moderada",
    description: "Agua apta solo para riego.",
    imageUrl: "https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=800",
    trend: "stable"
  },
  {
    id: "2",
    name: "RÃ­o Mololoa",
    coordinates: [21.51585409995925, -104.88884195220137],
    quality: "Peligrosa",
    description: "Agua altamente contaminada, no debe ser usada.",
    imageUrl: "https://images.unsplash.com/photo-1473448912268-2022ce9509d8?w=800",
    trend: "worsening"
  },
  {
    id: "3",
    name: "Laguna de Mora",
    coordinates: [21.516758, -104.811909],
    quality: "Buena",
    description: "Agua en Ã³ptimas condiciones.",
    imageUrl: "https://images.unsplash.com/photo-1439066615861-d1af74d74000?w=800",
    trend: "improving"
  },
  {
    id: "4",
    name: "Cascada el Cora",
    coordinates: [21.414812193928924, -105.12698881963927],
    quality: "Buena",
    description: "Agua cristalina en Ã³ptimas condiciones.",
    imageUrl: "https://images.unsplash.com/photo-1508167728150-326ba76d8297?w=800",
    trend: "stable"
  },
  {
    id: "5",
    name: "RÃ­o Huicicila",
    coordinates: [21.320345002104013, -105.055278545828],
    quality: "Buena",
    description: "Agua en excelente estado.",
    imageUrl: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800",
    trend: "stable"
  },
  {
    id: "6",
    name: "Presa de Refilion",
    coordinates: [21.31053327955347, -104.89369957722249],
    quality: "Moderada",
    description: "Agua apta para riego.",
    imageUrl: "https://images.unsplash.com/photo-1433838552652-f9a46b332c40?w=800",
    trend: "stable"
  }
];

export function generateMockStations(): Station[] {
  return stationsData.map(station => ({
    ...station,
    lastUpdated: new Date(Date.now() - Math.random() * 3600000)
  }));
}

export function generateMockReadings(stationId: string, count: number = 24): Reading[] {
  const readings: Reading[] = [];
  const now = Date.now();
  
  for (let i = 0; i < count; i++) {
    const timestamp = new Date(now - (count - i) * 3600000);
    
    readings.push({
      id: `${stationId}-${i}`,
      stationId,
      timestamp,
      ph: 6.5 + Math.random() * 2,
      turbidity: Math.random() * 15,
      oxygen: 5 + Math.random() * 5,
      temperature: 18 + Math.random() * 8,
      wqi: 50 + Math.random() * 40
    });
  }
  
  return readings;
}

export function generateMockAlerts(): Alert[] {
  const stations = generateMockStations();
  const alerts: Alert[] = [];
  
  stations.forEach((station, idx) => {
    if (station.quality === "Peligrosa") {
      alerts.push({
        id: `alert-${idx}`,
        stationId: station.id,
        stationName: station.name,
        type: "critical",
        message: `Nivel crÃ­tico de contaminaciÃ³n detectado`,
        timestamp: new Date(Date.now() - Math.random() * 7200000),
        acknowledged: false
      });
    } else if (station.quality === "Moderada" && Math.random() > 0.5) {
      alerts.push({
        id: `alert-${idx}`,
        stationId: station.id,
        stationName: station.name,
        type: "warning",
        message: `Calidad del agua por debajo del nivel Ã³ptimo`,
        timestamp: new Date(Date.now() - Math.random() * 7200000),
        acknowledged: Math.random() > 0.7
      });
    }
  });
  
  return alerts;
}

export function getQualityColor(quality: WaterQuality): string {
  switch (quality) {
    case "Buena": return "hsl(142, 76%, 36%)";
    case "Moderada": return "hsl(38, 92%, 50%)";
    case "Peligrosa": return "hsl(0, 84%, 60%)";
  }
}

export function getQualityGradient(quality: WaterQuality): string {
  switch (quality) {
    case "Buena": return "from-green-500 to-emerald-600";
    case "Moderada": return "from-yellow-500 to-orange-500";
    case "Peligrosa": return "from-red-500 to-rose-600";
  }
}

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\lib\utils.ts
================================================================================
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\types\global.d.ts
================================================================================
declare module "*.css" {
  const content: { [className: string]: string };
  export default content;
}

declare module "*.scss" {
  const content: { [className: string]: string };
  export default content;
}

================================================================================
ARCHIVO: C:\Users\aimbo\OneDrive\Desktop\novasense\src\types\index.ts
================================================================================
// types/index.ts - Tipos globales del proyecto

export type WaterQuality = "Buena" | "Moderada" | "Peligrosa";

/**
 * Tendencia de la calidad del agua (agregar a tus tipos existentes)
 */
export type WaterTrend = 'improving' | 'stable' | 'worsening';

export interface Station {
  id: string;
  name: string;
  coordinates: [number, number]; // [latitude, longitude]
  quality: WaterQuality;
  description: string;
  imageUrl?: string;
  lastReading?: Reading;
  lastUpdated: Date;
  trend: WaterTrend;
}

export interface Reading {
  id: string;
  stationId: string;
  timestamp: Date;
  ph: number;
  turbidity: number; // NTU
  oxygen: number; // mg/L
  temperature: number; // Â°C
  wqi: number; // Water Quality Index (0-100)
}

export interface Alert {
  id: string;
  stationId: string;
  stationName: string;
  type: "critical" | "warning" | "info";
  message: string;
  timestamp: Date;
  acknowledged: boolean;
}

export interface DashboardStats {
  totalStations: number;
  goodQuality: number;
  moderateQuality: number;
  dangerousQuality: number;
  activeAlerts: number;
}

export interface ChartDataPoint {
  timestamp: string;
  ph: number;
  turbidity: number;
  oxygen: number;
  temperature: number;
}

